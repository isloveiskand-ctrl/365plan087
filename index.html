<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŸæ‘ç†è²¡å°ç®¡å®¶</title>
    <style>
        :root {
            --primary: #4CAF50;
            --expense: #f44336;
            --wish: #9c27b0;
            --piggy: #FF9800;
            --bg: #f8f9fa;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; background: var(--bg); margin: 0; padding: 0; color: #333; }
        .container { max-width: 600px; margin: 0 auto; padding: 10px 10px 80px 10px; }
        
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .card { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-bottom: 15px; }
        
        .live-clock {
            text-align: center;
            background: #222;
            color: #fff;
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 15px;
        }
        .live-clock .date-part { font-size: 0.9em; color: #bbb; display: block; margin-bottom: 4px; }
        .live-clock .time-part { font-size: 1.8em; font-weight: bold; color: #4CAF50; font-family: monospace; }

        .navbar { position: fixed; bottom: 0; left: 0; right: 0; background: white; display: flex; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); height: 70px; z-index: 1000; }
        .nav-item { flex: 1; text-align: center; display: flex; flex-direction: column; justify-content: center; font-size: 0.85em; cursor: pointer; color: #777; }
        .nav-item.active { color: var(--primary); font-weight: bold; background: #f9fff9; }
        .nav-icon { font-size: 1.5em; margin-bottom: 2px; }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .stat-item { padding: 12px; border-radius: 10px; text-align: center; color: white; font-size: 0.9em; }
        .stat-in { background: var(--primary); }
        .stat-out { background: var(--expense); }
        
        .input-group { display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px; }
        input, select, button { padding: 12px; border-radius: 8px; border: 1px solid #ddd; font-size: 16px; width: 100%; }
        .btn-main { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }

        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(45px, 1fr)); gap: 6px; }
        .day-box { background: #fff; border: 1px solid #eee; aspect-ratio: 1; display: flex; align-items: center; justify-content: center; font-size: 0.85em; border-radius: 8px; cursor: pointer; }
        .day-box.saved { background: var(--piggy); color: white; text-decoration: line-through; border: none; font-weight: bold; }
        
        .history-list { max-height: 200px; overflow-y: auto; background: #fffcf5; border-radius: 8px; padding: 10px; font-size: 0.85em; }
        .history-item { border-bottom: 1px dashed #ffd180; padding: 10px 0; display: flex; justify-content: space-between; }
        .time-label { color: #888; font-size: 0.8em; }

        table { width: 100%; border-collapse: collapse; font-size: 0.85em; }
        th { background: #f8f9fa; padding: 10px; text-align: left; }
        td { border-bottom: 1px solid #eee; padding: 12px 5px; }
    </style>
</head>
<body>

<div class="container">
    <h1 id="pageTitle" style="text-align: center; font-size: 1.3em; margin-bottom: 10px; color: #2c3e50;">æŸæ‘æ”¶æ”¯ç´€éŒ„</h1>

    <div id="pageAccount" class="page active">
        <div class="live-clock">
            <span class="date-part" id="liveDate">----/--/--</span>
            <span class="time-part" id="liveTime">00:00:00</span>
        </div>

        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <button onclick="changeMonth(-1)" style="width:auto; padding:5px 15px;">â¬…ï¸</button>
                <span id="monthDisplay" style="font-weight:bold;"></span>
                <button onclick="changeMonth(1)" style="width:auto; padding:5px 15px;">â¡ï¸</button>
            </div>
            <div class="stats-grid">
                <div class="stat-item stat-in">æœ¬æœˆæ”¶å…¥<br><b id="monIn">$ 0</b></div>
                <div class="stat-item stat-out">æœ¬æœˆæ”¯å‡º<br><b id="monOut">$ 0</b></div>
            </div>
            <div class="input-group">
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px;">
                    <input type="number" id="accAmt" placeholder="è«‹è¼¸å…¥é‡‘é¡" inputmode="numeric">
                    <select id="accType">
                        <option value="income">â• æ”¶å…¥</option>
                        <option value="expense">â– æ”¯å‡º</option>
                    </select>
                </div>
                <input type="text" id="accNote" placeholder="å‚™è¨» (éå¿…å¡«)">
                <button class="btn-main" onclick="addRecord()">å­˜å…¥ç´€éŒ„</button>
            </div>
            <div style="overflow-x: auto;">
                <table>
                    <thead><tr><th>æ™‚é–“</th><th>å‚™è¨»</th><th>é‡‘é¡</th></tr></thead>
                    <tbody id="accTable"></tbody>
                </table>
            </div>
        </div>
        <button style="color:red; background:none; border:none; width:100%; font-size:0.8em;" onclick="resetPart('acc')">ğŸ—‘ï¸ é‡è¨­æŸæ‘æ”¶æ”¯ç´€éŒ„</button>
    </div>

    <div id="page365" class="page">
        <div class="card">
            <h2 style="font-size:1em; margin-bottom:12px;">ğŸ“… æŸæ‘365æ—¥å­˜éŒ¢æ ¼</h2>
            <div class="grid-container" id="grid365"></div>
        </div>
        <div class="card">
            <h2 style="font-size:1em;">ğŸ“œ æŸæ‘å­˜æ¬¾æ˜ç´°</h2>
            <div class="history-list" id="piggyHistory"></div>
            <div style="text-align: right; margin-top: 15px; font-weight: bold; color: var(--piggy); font-size: 1.3em;">
                ç´¯è¨ˆï¼š<span id="piggyTotal">$ 0</span>
            </div>
        </div>
        <button style="color:red; background:none; border:none; width:100%; font-size:0.8em;" onclick="resetPart('365')">ğŸ—‘ï¸ æ¸…ç©ºå­˜éŒ¢é€²åº¦</button>
    </div>

    <div id="pageWish" class="page">
        <div class="card">
            <h2 style="font-size:1em;">âœ¨ æˆ‘çš„é¡˜æœ›</h2>
            <div style="display: flex; gap: 8px; margin-bottom: 15px;">
                <input type="text" id="wishInput" style="flex:1" placeholder="å­˜åˆ°éŒ¢å¾Œæƒ³è²·ä»€éº¼ï¼Ÿ">
                <button class="btn-main" style="background:var(--wish); width:80px;" onclick="addWish()">å¢åŠ </button>
            </div>
            <div id="wishList"></div>
        </div>
        <button style="color:red; background:none; border:none; width:100%; font-size:0.8em;" onclick="resetPart('wish')">ğŸ—‘ï¸ æ¸…ç©ºé¡˜æœ›æ¸…å–®</button>
    </div>
</div>

<nav class="navbar">
    <div class="nav-item active" onclick="switchPage('Account', this)">
        <span class="nav-icon">ğŸ“’</span><span>æŸæ‘æ”¶æ”¯</span>
    </div>
    <div class="nav-item" onclick="switchPage('365', this)">
        <span class="nav-icon">ğŸ·</span><span>365è¨ˆç•«</span>
    </div>
    <div class="nav-item" onclick="switchPage('Wish', this)">
        <span class="nav-icon">ğŸ</span><span>é¡˜æœ›</span>
    </div>
</nav>

<script>
    let viewDate = new Date();
    let records = JSON.parse(localStorage.getItem('bo_records_v1')) || [];
    let savedData = JSON.parse(localStorage.getItem('bo_365_v1')) || [];
    let wishes = JSON.parse(localStorage.getItem('bo_wishes_v1')) || [];

    function getTaipeiTime() {
        const now = new Date();
        const options = { 
            timeZone: 'Asia/Taipei', year: 'numeric', month: '2-digit', day: '2-digit',
            hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false 
        };
        const formatter = new Intl.DateTimeFormat('zh-TW', options);
        const parts = formatter.formatToParts(now);
        const map = {}; parts.forEach(p => map[p.type] = p.value);
        return {
            full: `${map.year}/${map.month}/${map.day} ${map.hour}:${map.minute}`,
            date: `${map.year}å¹´${map.month}æœˆ${map.day}æ—¥`,
            time: `${map.hour}:${map.minute}:${map.second}`,
            timestamp: now.getTime()
        };
    }

    function updateLiveClock() {
        const t = getTaipeiTime();
        document.getElementById('liveDate').textContent = t.date;
        document.getElementById('liveTime').textContent = t.time;
    }
    setInterval(updateLiveClock, 1000);

    function switchPage(pageId, navEl) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('page' + pageId).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        navEl.classList.add('active');
        const titles = { 'Account': 'æŸæ‘æ”¶æ”¯ç´€éŒ„', '365': 'æŸæ‘365æ—¥å­˜éŒ¢è¨ˆç•«', 'Wish': 'é¡˜æœ›æ¸…å–®' };
        document.getElementById('pageTitle').innerText = titles[pageId];
        window.scrollTo(0,0);
    }

    function updateUI() {
        const year = viewDate.getFullYear();
        const month = viewDate.getMonth();
        document.getElementById('monthDisplay').textContent = `${year}å¹´${month + 1}æœˆ`;

        const monthRecords = records.filter(r => {
            const d = new Date(r.timestamp);
            return d.getFullYear() === year && d.getMonth() === month;
        });
        let ti = 0, to = 0, html = '';
        monthRecords.forEach(r => {
            if (r.type === 'income') ti += r.amount; else to += r.amount;
            html += `<tr><td><span class="time-label">${r.time.split(' ')[0]}</span><br>${r.time.split(' ')[1]}</td><td>${r.note}</td><td style="color:${r.type==='income'?'#4CAF50':'#f44336'}">${r.type==='income'?'+':'-'}${r.amount}</td></tr>`;
        });
        document.getElementById('monIn').textContent = `$${ti.toLocaleString()}`;
        document.getElementById('monOut').textContent = `$${to.toLocaleString()}`;
        document.getElementById('accTable').innerHTML = html;

        renderGrid();
        renderHistory();

        document.getElementById('wishList').innerHTML = wishes.map((w, i) => `
            <div style="display:flex; justify-content:space-between; padding:12px; border-bottom:1px solid #eee; align-items:center;">
                <span>ğŸŒŸ ${w}</span><button onclick="delWish(${i})" style="color:#999; border:none; background:none; width:auto;">ç§»é™¤</button>
            </div>
        `).join('');

        localStorage.setItem('bo_records_v1', JSON.stringify(records));
        localStorage.setItem('bo_365_v1', JSON.stringify(savedData));
        localStorage.setItem('bo_wishes_v1', JSON.stringify(wishes));
    }

    function addRecord() {
        const amtInput = document.getElementById('accAmt');
        const noteInput = document.getElementById('accNote');
        const amt = parseInt(amtInput.value);
        // å„ªåŒ–ï¼šè‹¥å‚™è¨»ç‚ºç©ºï¼Œè‡ªå‹•å¡«å…¥ã€Œæœªå‚™è¨»ã€
        const note = noteInput.value.trim() === "" ? "æœªå‚™è¨»" : noteInput.value;
        const type = document.getElementById('accType').value;

        if (isNaN(amt) || amt <= 0) {
            alert("è«‹è¼¸å…¥æ­£ç¢ºçš„é‡‘é¡ï¼");
            return;
        }

        const timeData = getTaipeiTime();
        records.push({ timestamp: timeData.timestamp, time: timeData.full, amount: amt, note: note, type: type });
        amtInput.value = '';
        noteInput.value = '';
        updateUI();
    }

    function renderGrid() {
        const container = document.getElementById('grid365');
        if (!container) return;
        container.innerHTML = '';
        const savedA = savedData.map(d => d.amount);
        for (let i = 1; i <= 365; i++) {
            const box = document.createElement('div');
            box.className = `day-box ${savedA.includes(i) ? 'saved' : ''}`;
            box.textContent = i;
            box.onclick = () => {
                if (savedA.includes(i)) {
                    if(confirm(`è¦å–æ¶ˆé€™ç­† $${i} çš„å­˜æ¬¾å—ï¼Ÿ`)) savedData = savedData.filter(d => d.amount !== i);
                } else {
                    const timeData = getTaipeiTime();
                    savedData.push({ amount: i, time: timeData.full });
                }
                updateUI();
            };
            container.appendChild(box);
        }
    }

    function renderHistory() {
        const hist = document.getElementById('piggyHistory');
        if (!hist) return;
        const total = savedData.reduce((s, x) => s + x.amount, 0);
        document.getElementById('piggyTotal').textContent = `$${total.toLocaleString()}`;
        hist.innerHTML = [...savedData].reverse().map(d => `
            <div class="history-item"><span><span class="time-label">${d.time}</span><br><b>å­˜å…¥ $${d.amount}</b></span></div>
        `).join('');
    }

    function addWish() {
        const w = document.getElementById('wishInput').value;
        if(w) { wishes.push(w); document.getElementById('wishInput').value = ''; updateUI(); }
    }
    function delWish(i) { wishes.splice(i,1); updateUI(); }
    function changeMonth(o) { viewDate.setMonth(viewDate.getMonth() + o); updateUI(); }

    function resetPart(type) {
        if (confirm("è³‡æ–™åˆªé™¤å¾Œç„¡æ³•æ‰¾å›ï¼Œç¢ºå®šè¦é‡è¨­å—ï¼Ÿ")) {
            if (type === 'acc') records = [];
            else if (type === '365') savedData = [];
            else if (type === 'wish') wishes = [];
            updateUI();
        }
    }

    updateLiveClock();
    updateUI();
</script>
</body>
</html>

